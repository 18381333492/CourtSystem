@{
    ViewBag.Title = "商品列表";
    Layout = "~/Areas/Admin/Views/Shared/_Layout_EuiAndBoot.cshtml";
}
<link href="~/Areas/Admin/Content/icheck/skins/square/blue.css" rel="stylesheet" />
<script src="~/Areas/Admin/Content/icheck/icheck.min.js"></script>
<table id="Goods" style="height:100%;width:100%"></table>
<div id="Goods_toolbar" style="padding:8px;">
    <form id="search">
        <span>上/下架:</span>
        <select name="iState" class="form-control input-sm" style="width:100px;">
            <option value="-1">--请选择--</option>
            <option value="0">下架</option>
            <option value="1">上架</option>
        </select>
        <span>商品类型:</span>
        <select name="iState" class="form-control input-sm" style="width:100px;">
            <option value="-1">--请选择--</option>
            <option value="0">普通商品</option>
            <option value="1">虚拟商品</option>
        </select>
        <span>模糊查询:</span>
        <input type="text" class="form-control input-sm" placeholder="商品名/商品编号" style="width:200px">
        <button type="button" class="btn btn-default  btn-sm searchText">查 询</button>
        &nbsp; &nbsp; @Html.Partial("~/Areas/Admin/Views/Shared/_Button.cshtml")
    </form>
</div>
<script type="text/javascript">
    $(function () {
        var buttonList=@Html.Raw(ViewData["Button_NotToolbar"]);
        var admin = new adminPackage();
        //注册路由
        admin.routeRegister("Admin", "Goods");

        //模糊查询
        $('.searchText').on("click", function () {
            var searchText = $('#search input').val();
            admin.grid.datagrid({
                queryParams: {
                    searchText: searchText
                }
            });
        });

        //新增操作
        $('.Goods_add').on("click", function () {
            admin.creatModal(admin.route("Add"));
        });

        //编辑操作
        function UpdateGoods(id){
            admin.creatModal(admin.route("Edit?sGoodsId="+id));
        }

        //上下架操作
        $('.Goods_cancel').on("click", function () {
            var selected = admin.grid.datagrid('getSelections');
            if (selected.length > 0) {
                var array = [];
                $(selected).each(function () {
                    array.push(admin.formate("'#'", this.ID));
                });
                admin.confirm("确认要删除选择的数据？", function () {
                    admin.Ajax(admin.route("Cancel"), { Ids: array.join() }, function (r) {
                        admin.grid.datagrid("reload");
                        admin.alert("删除成功");
                    });
                })
            }
            else {
                admin.alert("请选择一条数据进行操作!");
            }
        });

        /*!
        * method:数据列表(datagrid)的绑定
        */
        admin.grid.datagrid({
            fit:true,
            url: admin.route('List'),
            toolbar:admin.toolbar,
            fitColumns:true,
            rownumbers:true,
            striped: true,
            pagination: true,
            pageSize:20,
            loadMsg: "正在加载...",
            columns: [[
                { field: 'sGoodsName', title: '商品名称', align: 'center', sortable: true, width: 180 },
                { field: 'sGoodsNo', title: '商品编号', align: 'center', sortable: true, width: 80 },
                {
                    field: 'iGoodsType', title: '商品类型', align: 'center', sortable: true, width: 60, formatter: function (value) {
                        if (value == 0) return "普通商品";
                        else return "虚拟商品";
                    }
                },
                { field: 'iCount', title: '库存', align: 'center', sortable: true, width: 40 },
                { field: 'sGoodsPrices', title: '商品价格', align: 'center', sortable: true, width: 60,formatter:function(value){return value.toFixed(2); } },
                { field: 'sDisPrices', title: '优惠价格', align: 'center', sortable: true, width: 60 ,formatter:function(value){return value.toFixed(2); }},
                {
                    field: 'IsRateGiving', title: '比例增加(优惠)', align: 'center', sortable: true, width: 70, formatter: function (value) {
                        if (value) return "<span style='color:blue'>启用</span>";
                        else return "<span style='color:red'>禁用</span>";
                    }
                },
                { field: 'iIntegral', title: '积分', align: 'center', sortable: true, width: 60 },
                {
                    field: 'IsRateAdd', title: '比例增加(积分)', align: 'center', sortable: true, width: 70, formatter: function (value) {
                        if (value) return "<span style='color:blue'>启用</span>";
                        else return "<span style='color:red'>禁用</span>";
                    }
                },
                {
                    field: 'bIsShelves', title: '上/下架', align: 'center', sortable: true, width: 80, formatter: function (value) {
                        if (value) return "<span style='color:green'>上架</span>";
                        else return "<span style='color:red'>下架</span>";
                    }
                },
                { field: 'dInsertTime', title: '添加时间', align: 'center', sortable: true, width: 100 },
                {
                    field: 'ID', title: '操作', align: 'center', width: 130, formatter: function (value,row) {
                        var html = [];
                        html.push('<div style="padding:3px;">');
                        $(buttonList).each(function(){
                            html.push('<button type="button" class="btn '+this.sButtonIcon+' btn-sm '+this.sButtonSign+'" data-id="' + value + '">');
                            html.push(''+this.sButtonName+'</button>&nbsp&nbsp');
                        });
                        html.push('</div>');
                        return html.join('');
                    }
                },
            ]],
            onLoadSuccess: function () {
                //编辑事件绑定
                $('.Goods_edit').on("click",function(event){
                    event.stopPropagation();
                    var id=$(this).attr("data-id");
                    UpdateGoods(id);
                });


                ////重置密码事件绑定
                //$('.Goods_reset').on("click", function (event) {
                //    event.stopPropagation();
                //    var ID = $(this).attr("data-id");
                //    admin.confirm("确定要将该账号密码重置成为123456？", function () {
                //        admin.Ajax(admin.route("Reset"), { ID: ID }, function (r) {
                //            admin.grid.datagrid('reload');
                //            admin.alert("操作成功");
                //        });
                //    });
                //});

                ////冻结事件绑定
                //$('.Goods_freeze').on("click", function (event) {
                //    event.stopPropagation();
                //    var ID = $(this).attr("data-id");
                //    var iState = parseInt($(this).attr("data-iState"));//会员状态 1-正常 0-冻结
                //    var operate = iState == 0 ? "解冻" : "冻结";
                //    admin.confirm("确定要" + operate + "这条数据？", function () {
                //        admin.Ajax(admin.route("Freeze"), { ID: ID }, function (r) {
                //            admin.grid.datagrid('reload');
                //            admin.alert("操作成功");
                //        });
                //    });
                //});

                ////删除事件绑定
                //$('.Goods_delete').on("click", function (event) {
                //    event.stopPropagation();
                //    var ID = admin.formate("'#'", $(this).attr("data-id"));
                //    admin.confirm("确定要删除这条数据？", function () {
                //        admin.Ajax(admin.route("Cancel"), { Ids: ID }, function (r) {
                //            admin.grid.datagrid('reload');
                //            admin.alert("删除成功");
                //        });
                //    });
                //});
            }
        });
    });
</script>

